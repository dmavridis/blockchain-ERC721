# ERC721 NFT Capstone Project 

### Structure

Three major contracts are involved in the implementation of the Dapp, namely `ERC721Mintable.sol`, `Verifier.sol`, `SonlSquareVerifier.sol`. Other supportive contacts are also involved, mainly from the `OpenZeppellin` package. 

The top level contract is the `SonlSquareVerifier.sol` which extends the `ERC721Mintable.sol` contract and is using an inteface to the `Verifier.sol` cpntract, that is generated by Zokrates.

### Tips

To run the test, ganache is invoked using the following commands (mnemonic words are not required)

```
ganache-cli -p 8545 -m 'candy maple cake sugar pudding cream honey rich smooth crumble sweet treat' -a 20
```

Those mnemonic words are not the same as the ones used for to interact through Metamask with the deployed contract on Rinkeby.

For the installation of the packages, user needs to run `npm run`

### Running Zokrates

Zokrates is invoked in docker with the following command. Replace the `<absolute path>`with your path to the project. 

```
docker run -v <absolute path>\Blockchain-Capstone\zokrates\code:/home/zokrates/cod
e  -ti zokrates/zokrates /bin/bash
```

Compile the program written in ZoKrates DSL

```
../../zokrates compile -i square.code
```

```
 ../../zokrates setup --proving-scheme pghr13
```

```
~/zokrates compute-witness -a 3 9 
```

```
~/zokrates generate-proof --proving-scheme pghr13
```

```
~/zokrates export-verifier --proving-scheme pghr13
```

### Testing

There are three files used for testing.  Running

```
truffle test
```

produces the following output:

```
Contract: TestERC721Mintable
    match erc721 spec
      √ should return total supply (73ms)
      √ should get token balance (61ms)
      √ should return token uri (125ms)
      √ should transfer token from one owner to another (283ms)
    have ownership properties
      √ should fail when minting when address is not contract owner (101ms)
      √ should return contract owner (48ms)

  Contract: TestSolnSquareVerifier
    Mint with square verifier
      √ Verifying minting (4729ms)
      √ Should fail when minting without verifying (283ms)

  Contract: TestSquareVerifier
    Verify Tx
      √ Correct verification (3058ms)
      √ Verifier captures wrong input (108ms)


  10 passing (25s)
```

### Deployment to Rinkeby

In order to deploy to Rinkeby test network, the `truffle-config.js` file has been appropriately modified. Infura key is: `533aeb9e6d1540f5b1825366fde32f23`. Then executing the command:

```
truffle migrate --reset --network
```

logs the output: 

```
Starting migrations...
======================
> Network name:    'rinkeby'
> Network id:      4
> Block gas limit: 0x6acfc0


1_initial_migration.js
======================

   Deploying 'Migrations'
   ----------------------
   > transaction hash:    0xd9104bf66d2f012481007a0f0f04928eb40ec80d6b1fab1e9309f39f2cbe446d
   > Blocks: 0            Seconds: 14
   > contract address:    0xD2874546a9ebF0CDAE3674a2Da109A9537F07eA6
   > block number:        4342041
   > block timestamp:     1557260078
   > account:             0xefa409f8db2dCa2D0d8838ab72CBA15Ffc4e4026
   > balance:             1.852513189
   > gas used:            284908
   > gas price:           20 gwei
   > value sent:          0 ETH
   > total cost:          0.00569816 ETH

   Pausing for 2 confirmations...
   ------------------------------
   > confirmation number: 1 (block: 4342042)
   > confirmation number: 2 (block: 4342043)

   > Saving migration to chain.
   > Saving artifacts
   -------------------------------------
   > Total cost:          0.00569816 ETH


2_deploy_contracts.js
=====================

   Deploying 'Verifier'
   --------------------
   > transaction hash:    0xa06f858c2676ce2a6b5b1446a9fe98940c8c07f8bdedff8e7aa380e4fb3e17f7
   > Blocks: 0            Seconds: 9
   > contract address:    0x978096913ccC7442B0c730C5b973FE061eA2F7B4
   > block number:        4342047
   > block timestamp:     1557260168
   > account:             0xefa409f8db2dCa2D0d8838ab72CBA15Ffc4e4026
   > balance:             1.816010969
   > gas used:            1783077
   > gas price:           20 gwei
   > value sent:          0 ETH
   > total cost:          0.03566154 ETH

   Pausing for 2 confirmations...
   ------------------------------
   > confirmation number: 1 (block: 4342048)
   > confirmation number: 2 (block: 4342049)

   Deploying 'SolnSquareVerifier'
   ------------------------------
   > transaction hash:    0x538b2119f0da9c6e8c21efca58b000dead9b235c11f6875f33ee58547158bf74
   > Blocks: 1            Seconds: 17
   > contract address:    0x5E6561DBAa64Ae694aA5094C469AB5cE922a287a
   > block number:        4342051
   > block timestamp:     1557260228
   > account:             0xefa409f8db2dCa2D0d8838ab72CBA15Ffc4e4026
   > balance:             1.727671109
   > gas used:            4416993
   > gas price:           20 gwei
   > value sent:          0 ETH
   > total cost:          0.08833986 ETH

   Pausing for 2 confirmations...
   ------------------------------
   > confirmation number: 1 (block: 4342053)
   > confirmation number: 2 (block: 4342054)

   > Saving migration to chain.
   > Saving artifacts
   -------------------------------------
   > Total cost:           0.1240014 ETH


Summary
=======
> Total deployments:   3
> Final cost:          0.12969956 ETH
```

The deployed contract can be found in:

https://rinkeby.etherscan.io/address/0x5E6561DBAa64Ae694aA5094C469AB5cE922a287a

### Transactions and OpenSea listing

Ten minting transaction are taking place, using the MyEtherWallet tool with Metamask. The abi is saved in the `abi.json` file. 

In OpenSea, the marketplace is located in:

https://rinkeby.opensea.io/assets/HomeToken

Ten items with tokenIds `1001-1010` are minted and the item `1005` is put into sale and a transaction is taking place and owner changes.  



## Project Review prerequisites

### Project Deliverables

| CRITERIA | MEETS SPECIFICATIONS                                         |
| :------- | :----------------------------------------------------------- |
| Write Up | Student includes a README to explain how to test their code. |
| Write Up | Student provides Contract Addresses, Contract Abi's, OpenSea MarketPlace Storefront link's. |

This file provides the information on how to test the code

The required links are summarized as:

- **Contract address:** https://rinkeby.etherscan.io/address/0x5E6561DBAa64Ae694aA5094C469AB5cE922a287a
- ABI: Abi is part of the file and is copied for conveniece in the abi.json file
- **OpenSea Marketplace:** https://rinkeby.opensea.io/assets/HomeToken



### ERC721

| CRITERIA                                     | MEETS SPECIFICATIONS                                         |
| :------------------------------------------- | :----------------------------------------------------------- |
| ERC721 Mintable Contract                     | Student completes the boilerplate ERC721 Mintable Contract in `ERC721Mintable.sol` |
| ERC721 Mintable Contract Test Cases          | Student writes and passes the test cases in `TestERC721Mintable.js` |
| ERC721 Mintable Contract Zokrates Test       | Student writes and passes the test cases in `TestSquareVerifier.js` |
| ERC721 Mintable Contract Zokrates Test Cases | Student writes and passes the test cases in `TestSolnSquareVerifier.js` |

- `ERC721Mintable.sol` is complete
- `TestERC721Mintable.js` test cases are written and passed as shown earlier
- `TestSquareVerifier.js` test cases are written and passed
- `TestSolnSquareVerifier.js` test cases are written and passed

### Zokrates

| CRITERIA                           | MEETS SPECIFICATIONS                                         |
| :--------------------------------- | :----------------------------------------------------------- |
| Zokrates program written using DSL | Student completes the Zokrates proof in square.code by adding the variable names in `square.code` |
| Zokrates Test Cases                | Student completes test contract in `SolnSquareVerifier.sol`  |
| Zokrates Test Cases                | Student writes and passes the test cases in `TestSolnSquareVerifier.js` |

- Variables in `square.code` are replaced
- `SolnSquareVerifier.sol` is complete
- `TestSolnSquareVerifier.js` is implemented and passes the test cases



## OpenSea Marketplace

| CRITERIA     | MEETS SPECIFICATIONS                                         |
| :----------- | :----------------------------------------------------------- |
| Market Place | Student list ERC721/ ZoKrates tokens & complete transactions on market place |

- Market Place is is completed in OpenSea in the address: https://rinkeby.opensea.io/assets/HomeToken



## Deployment

| CRITERIA   | MEETS SPECIFICATIONS                                        |
| :--------- | :---------------------------------------------------------- |
| Deployment | Student deploys ERC721 contracts with Zokrates integration. |

- ERC721 contracts with Zokrates integration are deployed on Rinkeby




## References

- Student hub
